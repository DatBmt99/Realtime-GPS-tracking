<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/elements/dom-repeat.html"><link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html"><link rel="import" href="../vaadin-button/vaadin-button.html"><link rel="import" href="vaadin-upload-icons.html"><link rel="import" href="vaadin-upload-file.html"></head><body><dom-module id="vaadin-upload-default-theme" theme-for="vaadin-upload"><template><style>:host{text-align:left;}:host(:not([nodrop])){border:1px dashed;padding:1em;}[part="drop-label-icon"]{margin:0 1em;}</style></template></dom-module><dom-module id="vaadin-upload"><template><style>:host{display:block;position:relative;}:host([hidden]){display:none !important;}div[hidden]{display:none;}:host(:not([nodrop])){overflow:hidden;}[part="primary-buttons"]{display:flex;flex-wrap:wrap;}[part="drop-label"]{display:flex;flex:1 1 auto;}[part="drop-label-icon"]{font-family:'vaadin-upload-icons';}[part="drop-label-icon"]::before{content:"\e905";}</style><div part="primary-buttons"><div id="addFiles" on-click="_onAddFilesClick"><slot name="add-button"><vaadin-button part="upload-button" id="addButton" disabled="[[maxFilesReached]]">[[_i18nPlural(maxFiles, i18n.addFiles, i18n.addFiles.*)]]</vaadin-button></slot></div><div part="drop-label" hidden$="[[nodrop]]" id="dropLabelContainer"><slot name="drop-label-icon"><div part="drop-label-icon"></div></slot><slot name="drop-label" id="dropLabel">[[_i18nPlural(maxFiles, i18n.dropFiles, i18n.dropFiles.*)]]</slot></div></div><slot name="file-list"><div id="fileList" part="file-list"><template is="dom-repeat" items="[[files]]" as="file"><vaadin-upload-file file="[[file]]"></vaadin-upload-file></template></div></slot><slot></slot><input type="file" id="fileInput" on-change="_onFileInputChange" hidden="" accept$="{{accept}}" multiple$="[[_isMultiple(maxFiles)]]"></template><script>{class a extends Vaadin.ThemableMixin(Polymer.Element){static get is(){return'vaadin-upload'}static get version(){return'3.0.0'}static get properties(){return{nodrop:{type:Boolean,reflectToAttribute:!0,value:function(){try{return!!document.createEvent('TouchEvent')}catch(a){return!1}}},target:{type:String,value:''},method:{type:String,value:'POST'},headers:{type:Object,value:{}},timeout:{type:Number,value:0},_dragover:{type:Boolean,value:!1,observer:'_dragoverChanged'},files:{type:Array,notify:!0,value:function(){return[]}},maxFiles:{type:Number,value:Infinity},maxFilesReached:{type:Boolean,value:!1,notify:!0,readOnly:!0,computed:'_maxFilesAdded(maxFiles, files.length)'},accept:{type:String,value:''},maxFileSize:{type:Number,value:Infinity},_dragoverValid:{type:Boolean,value:!1,observer:'_dragoverValidChanged'},formDataName:{type:String,value:'file'},noAuto:{type:Boolean,value:!1},withCredentials:{type:Boolean,value:!1},i18n:{type:Object,value:function(){return{dropFiles:{one:'Drop file here...',many:'Drop files here...'},addFiles:{one:'Select File',many:'Upload Files'},cancel:'Cancel',error:{tooManyFiles:'Too Many Files.',fileIsTooBig:'File is Too Big.',incorrectFileType:'Incorrect File Type.'},uploading:{status:{connecting:'Connecting...',stalled:'Stalled.',processing:'Processing File...',held:'Queued'},remainingTime:{prefix:'remaining time: ',unknown:'unknown remaining time'},error:{serverUnavailable:'Server Unavailable',unexpectedServerError:'Unexpected Server Error',forbidden:'Forbidden'}},units:{size:['B','kB','MB','GB','TB','PB','EB','ZB','YB']}}}}}}ready(){super.ready(),this.addEventListener('dragover',this._onDragover.bind(this)),this.addEventListener('dragleave',this._onDragleave.bind(this)),this.addEventListener('drop',this._onDrop.bind(this)),this.addEventListener('file-retry',this._onFileRetry.bind(this)),this.addEventListener('file-abort',this._onFileAbort.bind(this)),this.addEventListener('file-remove',this._onFileRemove.bind(this)),this.addEventListener('file-start',this._onFileStart.bind(this))}_formatSize(a){var b=Math.log;if('function'===typeof this.i18n.formatSize)return this.i18n.formatSize(a);const c=this.i18n.units.sizeBase||1e3,d=~~(b(a)/b(c)),e=Math.max(0,Math.min(3,d-1)),f=parseFloat((a/Math.pow(c,d)).toFixed(e));return f+' '+this.i18n.units.size[d]}_splitTimeByUnits(a){const b=[60,60,24,Infinity],c=[0];for(var d=0;d<b.length&&0<a;d++)c[d]=a%b[d],a=Math.floor(a/b[d]);return c}_formatTime(a,b){if('function'===typeof this.i18n.formatTime)return this.i18n.formatTime(a,b);for(;3>b.length;)b.push(0);return b.reverse().map((a)=>(10>a?'0':'')+a).join(':')}_formatFileProgress(a){return a.totalStr+': '+a.progress+'% ('+(0<a.loaded?this.i18n.uploading.remainingTime.prefix+a.remainingStr:this.i18n.uploading.remainingTime.unknown)+')'}_maxFilesAdded(a,b){return 0<=a&&b>=a}_onDragover(a){a.preventDefault(),this.nodrop||this._dragover||(this._dragoverValid=!this.maxFilesReached,this._dragover=!0),a.dataTransfer.dropEffect=!this._dragoverValid||this.nodrop?'none':'copy'}_onDragleave(a){a.preventDefault(),this._dragover&&!this.nodrop&&(this._dragover=this._dragoverValid=!1)}_onDrop(a){this.nodrop||(a.preventDefault(),this._dragover=this._dragoverValid=!1,this._addFiles(a.dataTransfer.files))}_createXhr(){return new XMLHttpRequest}_configureXhr(a){if('string'==typeof this.headers)try{this.headers=JSON.parse(this.headers)}catch(a){this.headers=void 0}for(var b in this.headers)a.setRequestHeader(b,this.headers[b]);this.timeout&&(a.timeout=this.timeout),a.withCredentials=this.withCredentials}_setStatus(a,b,c,d){a.elapsed=d,a.elapsedStr=this._formatTime(a.elapsed,this._splitTimeByUnits(a.elapsed)),a.remaining=Math.ceil(d*(b/c-1)),a.remainingStr=this._formatTime(a.remaining,this._splitTimeByUnits(a.remaining)),a.speed=~~(b/d/1024),a.totalStr=this._formatSize(b),a.loadedStr=this._formatSize(c),a.status=this._formatFileProgress(a)}uploadFiles(a){a=a||this.files,a=a.filter((a)=>!a.complete),Array.prototype.forEach.call(a,this._uploadFile.bind(this))}_uploadFile(a){if(a.uploading)return;const b=Date.now(),c=a.xhr=this._createXhr(a);let d,f;c.upload.onprogress=(g)=>{clearTimeout(d),f=Date.now();const e=(f-b)/1e3,h=g.loaded,i=g.total,j=~~(100*(h/i));a.loaded=h,a.progress=j,a.indeterminate=0>=h||h>=i,a.error?a.indeterminate=a.status=void 0:!a.abort&&(100>j?(this._setStatus(a,i,h,e),d=setTimeout(()=>{a.status=this.i18n.uploading.status.stalled,this._notifyFileChanges(a)},2e3)):(a.loadedStr=a.totalStr,a.status=this.i18n.uploading.status.processing,a.uploading=!1)),this._notifyFileChanges(a),this.dispatchEvent(new CustomEvent('upload-progress',{detail:{file:a,xhr:c}}))},c.onreadystatechange=()=>{if(4==c.readyState){if(clearTimeout(d),a.indeterminate=a.uploading=!1,a.abort)return void this._notifyFileChanges(a);a.status='';const b=this.dispatchEvent(new CustomEvent('upload-response',{detail:{file:a,xhr:c},cancelable:!0}));if(!b)return;0===c.status?a.error=this.i18n.uploading.error.serverUnavailable:500<=c.status?a.error=this.i18n.uploading.error.unexpectedServerError:400<=c.status&&(a.error=this.i18n.uploading.error.forbidden),a.complete=!a.error,this.dispatchEvent(new CustomEvent(`upload-${a.error?'error':'success'}`,{detail:{file:a,xhr:c}})),this._notifyFileChanges(a)}};const e=new FormData;a.uploadTarget=this.target||'',a.formDataName=this.formDataName;const g=this.dispatchEvent(new CustomEvent('upload-before',{detail:{file:a,xhr:c},cancelable:!0}));if(g){e.append(a.formDataName,a,a.name),c.open(this.method,a.uploadTarget,!0),this._configureXhr(c),a.status=this.i18n.uploading.status.connecting,a.uploading=a.indeterminate=!0,a.complete=a.abort=a.error=a.held=!1,c.upload.onloadstart=()=>{this.dispatchEvent(new CustomEvent('upload-start',{detail:{file:a,xhr:c}})),this._notifyFileChanges(a)};const b=this.dispatchEvent(new CustomEvent('upload-request',{detail:{file:a,xhr:c,formData:e},cancelable:!0}));b&&c.send(e)}}_retryFileUpload(a){const b=this.dispatchEvent(new CustomEvent('upload-retry',{detail:{file:a,xhr:a.xhr},cancelable:!0}));b&&this.async(this._uploadFile.bind(this,a))}_abortFileUpload(a){const b=this.dispatchEvent(new CustomEvent('upload-abort',{detail:{file:a,xhr:a.xhr},cancelable:!0}));b&&(a.abort=!0,a.xhr&&a.xhr.abort(),this._notifyFileChanges(a))}_notifyFileChanges(a){var b='files.'+this.files.indexOf(a)+'.';for(var c in a)a.hasOwnProperty(c)&&this.notifyPath(b+c,a[c])}_addFiles(a){Array.prototype.forEach.call(a,this._addFile.bind(this))}_addFile(a){if(this.maxFilesReached)return void this.dispatchEvent(new CustomEvent('file-reject',{detail:{file:a,error:this.i18n.error.tooManyFiles}}));if(0<=this.maxFileSize&&a.size>this.maxFileSize)return void this.dispatchEvent(new CustomEvent('file-reject',{detail:{file:a,error:this.i18n.error.fileIsTooBig}}));const b=a.name.match(/\.[^\.]*$|$/)[0],c=new RegExp('^('+this.accept.replace(/[, ]+/g,'|').replace(/\/\*/g,'/.*')+')$','i');return this.accept&&!(c.test(a.type)||c.test(b))?void this.dispatchEvent(new CustomEvent('file-reject',{detail:{file:a,error:this.i18n.error.incorrectFileType}})):void(a.loaded=0,a.held=!0,a.status=this.i18n.uploading.status.held,this.unshift('files',a),!this.noAuto&&this._uploadFile(a))}_removeFile(a){this.splice('files',this.files.indexOf(a),1)}_onAddFilesClick(){this.maxFilesReached||(this.$.fileInput.value='',this.$.fileInput.click())}_onFileInputChange(a){this._addFiles(a.target.files)}_onFileStart(a){this._uploadFile(a.detail.file)}_onFileRetry(a){this._retryFileUpload(a.detail.file)}_onFileAbort(a){this._abortFileUpload(a.detail.file)}_onFileRemove(a){a.stopPropagation(),this._removeFile(a.detail.file)}_dragoverChanged(a){a?this.setAttribute('dragover',a):this.removeAttribute('dragover')}_dragoverValidChanged(a){a?this.setAttribute('dragover-valid',a):this.removeAttribute('dragover-valid')}_i18nPlural(a,b){return 1==a?b.one:b.many}_isMultiple(){return 1!=this.maxFiles}}customElements.define(a.is,a),window.Vaadin=window.Vaadin||{},Vaadin.UploadElement=a}</script></dom-module></body></html>