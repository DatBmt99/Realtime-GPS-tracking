<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><script>(function(){'use strict';var a='/analytics/',b='/user_device_group/',c='/user_devices/';Polymer.FirebaseDeviceHelper={_notifyError:function(a){this.$.notifications.showError(a)},_notifyMessage:function(a){this.$.notifications.showNotification(a)},showSuccessToast:function(){intense.checked?toasts2.showSuccessToast(text2.value,_makeProperties()):toasts.showSuccessToast(text2.value,_makeProperties())},_firebaseAddDeviceGroup:function(a,c){var d=this,e=firebase.app(this.appName).database(),f=e.ref(b).push(),g=f.key,h={};h.key=g,h.name=c,e.ref(b).child(a.uid).child(g).update(h).then(function(){this.push('groupDevice',h),this.$.deviceDialog.$.groupSelect.setValueSelect(g)}.bind(this),function(a){this._notifyError(a),console.log(a)})},_firebaseGetDeviceGroup:function(a){console.log('_firebaseGetDeviceGroup');this;console.log(this.appName);var c=firebase.app(this.appName).database();return c.ref(b).child(a.uid).once('value').then(function(b){if(null==b.val())return void this._firebaseAddDeviceGroup(a,'Default');var c=[];Object.getOwnPropertyNames(b.val()).forEach(function(a){var d=b.val()[a];c.push(d)}),this.set('groupDevice',c),this.$.deviceDialog.$.groupSelect.setValueSelect(this.groupDevice[0].key)}.bind(this),function(a){this._notifyError(a),console.log(a)})},_firebaseDeviceIncrease:function(b){var c=firebase.app(this.appName).database(),d=c.ref(a).child('device');d.transaction(function(a){if(null===a){return{total:1}}var b=a.total;return a.total=b+1,a},function(a,b,c){a?console.log('Transaction failed abnormally!',a):b?console.log('User ada added!'):console.log('We aborted the transaction (because ada already exists).'),console.log('Ada\'s data: ',c.val())});var e=c.ref(a).child('user').child(b.uid).child('device');e.transaction(function(a){if(null===a){return{total:1}}var b=a.total;return a.total=b+1,a})},_firebaseDeviceReduction:function(b){var c=firebase.app(this.appName).database(),c=firebase.app(this.appName).database(),d=c.ref(a).child('device');d.transaction(function(a){if(null===a){return{total:0}}var b=a.total;return a.total=b-1||0,a},function(a,b,c){a?console.log('Transaction failed abnormally!',a):b?console.log('User ada added!'):console.log('We aborted the transaction (because ada already exists).'),console.log('Data: ',c.val())});var e=c.ref(a).child('user').child(b.uid).child('device');e.transaction(function(a){if(null===a){return{total:0}}var b=a.total;return a.total=b-1||0,a})},_firebaseAddDevice:function(a,d){var e=d.id,f=firebase.app(this.appName).database();f.ref(c).child(a.uid).child(e).once('value').then(function(g){if(g.val())this._notifyError('Oops! This device id already taken.');else{var h=d.name+','+d.group_type.name+','+d.id;d.search=this.removeSign(h),d.show=!0;f.ref(c).child(a.uid).child(e).update(d).then(function(){var c={};c.name=d.name,c.id=d.id,f.ref(b).child(a.uid).child(d.group_type.key).child('devices').child(c.id).set(c).then(function(){console.log('Add device to group device success')},function(a){console.log('Add device to group device error'),console.log(a)}),this._firebaseDeviceIncrease(a),this.$.menubar.hidden=!1,this._notifyMessage('Device added successfully!')}.bind(this),function(a){this._notifyError(a),console.log(a)})}}.bind(this),function(a){this._notifyErrorr(a),console.log(a)})},_firebaseShowDevice:function(a,b,d){var e=b.id,f=firebase.app(this.appName).database();f.ref(c).child(a.uid).child(e).once('value').then(function(b){b.val()?d?f.ref(c).child(a.uid).child(e).child('show').set(d).then(function(){},function(a){console.log(a)}):f.ref(c).child(a.uid).child(e).child('show').remove():this._notifyError('Oops! This device id not exit.')}.bind(this),function(a){this._notifyErrorr(a),console.log(a)})},_firebaseEditDevice:function(a,d){var e=d.id,f=firebase.app(this.appName).database();f.ref(c).child(a.uid).child(e).once('value').then(function(g){if(!g.val())this._notifyError('Oops! This device id not exit.');else{var h=d.name+',';+d.group_type.name+','+d.id,d.search=this.removeSign(h);f.ref(c).child(a.uid).child(e).update(d).then(function(){var c={};c.name=d.name,c.id=d.id,f.ref(b).child(a.uid).child(d.group_type.key).child('devices').child(c.id).set(c).then(function(){console.log('Add device to group device success')},function(a){console.log('Add device to group device error'),console.log(a)}),this._notifyMessage('Device edit successfully!')}.bind(this),function(a){this._notifyError(a),console.log(a)})}}.bind(this),function(a){this._notifyErrorr(a),console.log(a)})},_firebaseDeleteDevice:function(a,d){var e=d.id,f=firebase.app(this.appName).database();f.ref(b).child(a.uid).child(d.group_type.key).child('devices').child(d.id).remove(),f.ref(c).child(a.uid).child(e).remove(),f.ref('/public_devices/').child(e).remove(),this._firebaseDeviceReduction(a)}}})();</script></head><body></body></html>