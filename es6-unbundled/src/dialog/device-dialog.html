<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../src/dialog/paper-input-dialog.html"><link rel="import" href="../../src/components/info-group.html"><link rel="import" href="../../src/state-summary/state-info-input.html"><link rel="import" href="../../src/state-summary/state-info-select.html"><link rel="import" href="../../src/state-summary/state-select-icon.html"><link rel="import" href="../../src/state-summary/state-radio-group.html"><link rel="import" href="../../src/dialog/upload-image.html"></head><body><dom-module id="device-dialog"><template><style>app-toolbar{background-color:var(--primary-color);color:#fff;margin:20px 0;}paper-icon-button{--paper-icon-button-ink-color:white;}paper-progress{display:block;width:100%;--paper-progress-active-color:rgba(255, 255, 255, 0.5);--paper-progress-container-color:transparent;}iron-icon + [main-title]{margin-left:16px;}paper-dialog{margin-left:auto;margin-right:auto;width:80%;max-width:800px;}paper-dialog paper-dialog-scrollable{margin-top:0 !important;@apply (--layout-vertical);}paper-dialog > :first-child{margin-top:0;padding-left:16px;padding-right:16px;}paper-button.custom{--paper-button-ink-color:var(--paper-green-a700);--paper-button-flat-keyboard-focus:{background-color:var(--paper-green-a100);color:white !important;};--paper-button-raised-keyboard-focus:{background-color:var(--paper-green-a700) !important;color:white !important;};}paper-button.pink{color:var(--paper-green-a700);}paper-button.delete{--paper-button-ink-color:var(--paper-red-a700);--paper-button-flat-keyboard-focus:{background-color:var(--paper-red-a100);color:white !important;};--paper-button-raised-keyboard-focus:{background-color:var(--paper-red-a700) !important;color:white !important;};color:var(--paper-red-a700);}paper-button.new{background-color:var(--paper-green-500);color:white;}paper-button.cancel{background-color:var(--paper-grey-400);color:white;--paper-button-raised-keyboard-focus:{background-color:var(--paper-grey-600) !important;color:white !important;};}paper-button.cancel:hover{background-color:var(--paper-grey-500);}paper-button.disabled{color:#a8a8a8;cursor:auto;pointer-events:none;@apply --paper-button-disabled;}paper-dialog-scrollable{@apply --layout-vertical;}.state-select{padding-top:4px;padding-bottom:4px;padding-left:0;cursor:pointer;}.state{margin-right:16px;cursor:pointer;}.flex-horizontal-with-ratios{@apply --layout-horizontal;}.flexchild{@apply --layout-flex;}.flex-equal-justified{width:100%;margin-top:16px;@apply --layout-horizontal;@apply --layout-justified;}.small-toolbar{height:52px;font-size:18px;}</style><upload-image id="uploadImageDialog" class="dialog-toolbar no-padding" on-confirm="uploadImageDialogConfirm"></upload-image><paper-input-dialog id="inputDialog" dismiss-button="Cancel" confirm-button="OK" on-confirm="inputDialogConfirm"></paper-input-dialog><paper-dialog id="dialog" class="dialog-toolbar no-padding" modal="modal"><app-toolbar class="no-padding small-toolbar"><iron-icon icon="mdi:truck"></iron-icon><div main-title="main-title">[[actionTitle]]</div><paper-icon-button id="iconExit" on-tap="_tapCancel" icon="close"></paper-icon-button></app-toolbar><paper-dialog-scrollable><div class="flex-horizontal-with-ratios"><div class="flexchild state"><div class="state-select"><state-info-input id="deviceToken" name="deviceToken" icon="mdi:key-variant" label="Device ID" maxlength="28"></state-info-input></div><div class="state-select"><state-info-input id="deviceName" name="deviceName" icon="mdi:cellphone-link" label="Device name"></state-info-input></div><div class="state-select"><state-radio-group id="deviceShare" name="deviceIcon" icon="mdi:account-location" label="Share location"></state-radio-group></div></div><div class="flexchild"><div class="state-select"><state-info-input id="userToken" name="userToken" icon="mdi:account-key" value="[[user.uid]]" label="User Token" disable-class="disable-green"></state-info-input></div><div class="state-select"><state-info-select id="groupSelect" name="deviceType" icon="mdi:group" value-array="[[groupDevice]]" label="Device group" on-add-group="handleAddGroup"></state-info-select></div><div class="state-select"><state-select-icon id="deviceIcon" name="deviceIcon" icon="mdi:flower" label="Device icon" on-select-icon="handleSelectIcon"></state-select-icon></div></div></div></paper-dialog-scrollable><div class="buttons"><paper-button autofocus="" on-tap="_tapCancel">Cancel</paper-button><paper-button class$="[[computeStyle(online)]]" on-tap="_tapSave">Save</paper-button><paper-button class="custom delete" on-tap="_tapDelete" hidden$="[[!isEdit]]">Delete</paper-button></div></paper-dialog></template><script>class DeviceDialog extends Polymer.mixinBehaviors([Polymer.AppNetworkStatusBehavior],Polymer.Element){static get is(){return"device-dialog"}static get properties(){return{user:{type:Object,value:null},appName:{type:String},actionTitle:{type:String,value:"New device",reflectToAttribute:!0},groupDevice:{type:Array,notify:!0,value(){return[]}},isEdit:{type:Boolean,notify:!0,value:!1}}}ready(){super.ready()}computeStyle(a){return a?"custom pink":"custom disabled"}openDialog(){Polymer.dom(document.body).appendChild(this),setTimeout(function(){this.$.deviceToken.value=this.randId(),this.$.deviceName.value=null,this.$.deviceShare.setValueSelect("private"),this.$.dialog.open()}.bind(this),1)}openEditDialog(a){Polymer.dom(document.body).appendChild(this),setTimeout(function(){this.$.deviceToken.value=a.id,this.$.deviceName.value=a.name,this.$.groupSelect.setValueSelect(a.group_type.key),this.$.deviceIcon.iconLink=a.icon,a.public?this.$.deviceShare.setValueSelect("public"):this.$.deviceShare.setValueSelect("private"),this.$.dialog.open()}.bind(this),1)}closeDialog(){console.log(),this.$.dialog.close(),Polymer.dom(this.parentNode).removeChild(this)}_tapCancel(){this.dispatchEvent(new CustomEvent("device-dialog-dismiss",{bubbles:!0,composed:!0})),this.closeDialog()}_tapSave(){var a={name:this.$.deviceName.value||"No name",id:this.$.deviceToken.value||this.randId(),group_type:this.shadowRoot.querySelector("state-info-select").getValueSelected(),icon:this.$.deviceIcon.iconLink,owner:this.user.uid},b=this.$.deviceShare.getValueSelected();a["public"]=!("public"!==b.key)||null,this.isEdit?(a.lastEditAt=new Date().getTime(),this.dispatchEvent(new CustomEvent("device-dialog-confirm",{detail:{device:a,action:"edit"},bubbles:!0,composed:!0}))):(a.createdAt=new Date().getTime(),this.dispatchEvent(new CustomEvent("device-dialog-confirm",{detail:{device:a,action:"new"},bubbles:!0,composed:!0}))),this.closeDialog()}_tapDelete(){var a={name:this.$.deviceName.value||"No name",id:this.$.deviceToken.value||this.randId(),group_type:this.shadowRoot.querySelector("state-info-select").getValueSelected(),icon:this.$.deviceIcon.iconLink,owner:this.user.uid},b=this.$.deviceShare.getValueSelected();a["public"]=!("public"!==b.key)||null,this.dispatchEvent(new CustomEvent("device-dialog-confirm",{detail:{device:a,action:"delete"},bubbles:!0,composed:!0})),this.closeDialog()}randId(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;10>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}inputDialogConfirm(a){console.log(a.detail),this.dispatchEvent(new CustomEvent("in-dialog-confirm",{detail:a.detail,bubbles:!0,composed:!0}))}handleAddGroup(){this.$.inputDialog.textValue=null,this.$.inputDialog.open()}handleSelectIcon(){this.$.uploadImageDialog.openDialog()}}window.customElements.define(DeviceDialog.is,DeviceDialog);</script></dom-module></body></html>