<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../../bower_components/paper-styles/color.html"><link rel="import" href="../../bower_components/paper-styles/typography.html"><link rel="import" href="../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../bower_components/paper-card/paper-card.html"><link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html"><link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html"><link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html"><link rel="import" href="../../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html"><link rel="import" href="../components/pop-menu-item.html"></head><body><dom-module id="list-device"><template><style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning"><style>
        :host{display:block;}[hidden]{display:none !important;}#itemsList,
        #selectedItemsList{@apply --layout-flex;}.item{@apply --layout-horizontal;cursor:pointer;padding:16px 8px 16px 22px;border-bottom:1px solid #DDD;}.item.selected:focus,
        .item:focus{outline:0;background-color:#ddd;}.item.selected .star{color:var(--paper-blue-600);}.avatar{width:29px;height:40px;border-radius:25px;box-sizing:border-box;}.pad{@apply --layout-flex;@apply --layout-vertical;padding:0 16px;}.primary{font-size:16px;}.secondary{font-size:14px;}.dim{color:gray;}.star{width:24px;height:24px;}.content{@apply --layout-vertical;height:100%;}iron-list{@apply --layout-flex;}paper-card{height:100%;}iron-list{border-bottom:1px solid #f00;}app-toolbar{background-color:var(--primary-color);color:#fff;margin:20px 0;}.small-toolbar{height:48px;font-size:18px;margin:0;}#iconExit{margin-right:-8px;}iron-icon + [main-title]{margin-left:16px;}paper-icon-button{--paper-icon-button-ink-color:white;}d2l-dropdown-content{--d2l-dropdown-verticaloffset:8px;}.dim{opacity:var(--dark-primary-opacity);}paper-listbox paper-item{--paper-item-selected:{background-color:#FFFFFF;};--paper-item-focused:{background-color:#FFFFFF;font-weight:normal;};--paper-item-focused-before:{opacity:0;};--paper-item-selected-weight:normal;}paper-icon-item{--paper-item-icon-width:40px;--paper-item-icon:{padding-right:0;};}paper-icon-item .item-text{color:var(--primary-text-color);margin-left:var(--paper-checkbox-label-spacing, 8px);}paper-icon-item.iron-selected .item-text{opacity:1;}paper-menu-button{padding:0;}</style><firebase-query id="query" app-name="[[appName]]" path="/[[devicePath]]" data="{{liveDevicesData}}"></firebase-query><app-indexeddb-mirror session="[[user.uid]]" key="/[[devicePath]]" data="[[liveDevicesData]]" persisted-data="{{userDevices}}"></app-indexeddb-mirror><div class="content"><paper-card class="flex layout vertical" elevation="2"><div class="layout vertical flex"><app-toolbar class="small-toolbar"><div main-title="main-title">[[title]]</div><paper-icon-button id="iconExit" on-tap="_tapClose" icon="close"></paper-icon-button></app-toolbar><iron-list id="itemsList" items="[[userDevices]]"><template><div id$="litem[[index]]" style$="[[_computeZIndex(index, userDevices)]]"><div tabindex$="[[tabIndex]]" aria-label$="Select/Deselect [[item.name]]" class$="[[_computedClass(selected)]]"><img class="avatar" src="[[item.icon]]"><div class="pad"><div class="primary">[[item.name]]</div><div lass="secondary dim">[[item.group_type.name]]</div></div><paper-menu-button id$="optionMenu[[index]]" dynamic-align="true" vertical-align="bottom" horizontal-align="right" hidden$="[[!showOptionMenu]]"><iron-icon style$="[[_computeShowStyle(item.show)]]" icon="more-vert" slot="dropdown-trigger" index$="[[index]]" on-tap="showMenu"></iron-icon><paper-listbox slot="dropdown-content"><paper-item on-tap="optionMenuClicked" data-select$="[[_computeShowHide(item.show)]]"><pop-menu-item icon$="[[_computeShowIcon(item.show)]]">[[_computeShow(item.show)]]</pop-menu-item></paper-item><paper-item on-tap="optionMenuClicked" data-select="edit"><pop-menu-item icon="mdi:pencil">Edit</pop-menu-item></paper-item></paper-listbox></paper-menu-button></div><div class="border"></div></div></template></iron-list></div></paper-card></div></template><script>class ListDevice extends Polymer.Element{static get is(){return'list-device'}static get properties(){return{rootPath:String,user:{type:Object},appName:{type:String},userDevices:{type:Array,value(){return[]}},devicePath:{type:String},lastItemListZIndex:{type:Number},menuIndex:{type:Number},currentOpenItemId:{type:String},title:{type:String,value:'List device'},lastOpenItemId:{type:String},selfClose:{type:Boolean,value:!0},showOptionMenu:{type:Boolean,value:!0}}}ready(){super.ready(),this.shadowRoot.addEventListener('iron-overlay-opened',(a)=>this.optionMenuOpen(a)),this.shadowRoot.addEventListener('iron-overlay-closed',(a)=>this.optionMenuClose(a))}userDevicesChanged(){console.log('userDevicesChanged'),console.log(this.userDevices)}menuIndexChanged(a){console.log('menuIndexChanged:'),console.log(a)}computeLastOpenItemId(a){return'#litem'+(a.length+1)}computeLastItemListZIndex(a){return a.length+1}optionMenuOpen(){var a=this.menuIndex,b=this.userDevices.length-a;this.lastItemListZIndex=b,this.lastOpenItemId='#litem'+a}optionMenuClose(){if(this.lastOpenItemId){var a=this.shadowRoot.querySelector(this.lastOpenItemId);a&&(a.style.zIndex=this.lastItemListZIndex)}}optionMenuClicked(a){var b=this.menuIndex,c=this.shadowRoot.querySelector('#optionMenu'+b);c.opened&&c.close();for(var d=a.target,e=5,f=d.getAttribute('data-select');e&&!f;)d=d.parentElement,f=d.getAttribute('data-select'),e--;e&&this.dispatchEvent(new CustomEvent('device-menu-option',{detail:{item_index:this.menuIndex,item_option:f},bubbles:!0,composed:!0}))}_computeZIndex(a,b){var c=b.length-a;return'z-index: '+c}_computeShow(a){return a?'Hide':'Show'}_computeShowIcon(a){return a?'mdi:eye-off-outline':'mdi:eye-outline'}_computeShowStyle(a){return a?'width: 24px;height: 24px;color: var(--primary-color);':'width: 24px;height: 24px;'}_computeShowHide(a){return a?'hide':'show'}showMenu(a){var b=a.target,c=b.getAttribute('index'),d=this.shadowRoot.querySelector('#litem'+c);d.style.zIndex=this.userDevices.length+1,this.menuIndex=c}iconForItem(){return'mdi:dots-vertical'}_computedClass(a){var b='item';return a&&(b+=' selected'),b}_tapClose(){this.dispatchEvent(new CustomEvent('list-device-hide',{bubbles:!0,composed:!0}))}}window.customElements.define(ListDevice.is,ListDevice);</script></dom-module></body></html>