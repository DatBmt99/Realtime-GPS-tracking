<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"></head><body><dom-module id="phone-login-fire"><template><style>:host{display:block;margin:0 auto;}firebase-auth{display:none;}#reset{color:grey;text-decoration:none;font-size:12px;font-style:italic;font-weight:lighter;}#reset:hover{color:grey;text-decoration:underline;}.emailPWError{color:var(--error-color);text-align:center;font-size:16px;font-weight:500;line-height:24px;margin:0;padding:0;}.emailPWMessage{color:var(--primary-color);text-align:center;font-size:16px;font-weight:500;line-height:24px;margin:0;padding:0;}form{min-width:200px;margin:0 auto;}</style><firebase-auth app-name="{{appName}}" id="phone" provider="phone" user="{{user}}" signed-in="{{signedIn}}" status-known="{{statusKnown}}"></firebase-auth><template is="dom-if" if="{{debug}}"><div class="debug"><div>user.id = {{user.uid}}</div><div>signedIn = {{signedIn}}</div><div>statusKnown = {{statusKnown}}</div><div>user.displayName = {{user.displayName}}</div><div>user.email = {{user.email}}</div><div>user.emailVerified = {{user.emailVerified}}</div><div>user.isAnonymous = {{user.isAnonymous}}</div><div>user.photoURL = {{user.photoURL}} <img src$="{{user.photoURL}}" hidden="{{!user.photoURL}}" width="100px" height="100px"></div><div>user.providerId = {{user.providerId}}</div><paper-button on-tap="signOut">Log Out</paper-button></div></template><div><div class="emailPWError"></div><div class="emailPWMessage"></div></div><form on-submit="_signInPhone"><paper-input id="phoneInput" type="phone" label="Phone number" autofocus="" value="{{phoneNumber}}" auto-validate="" pattern="\+[0-9\s\-\(\)]+" error-message="Input is not an international phone number!" required="required"></paper-input><paper-input id="codeInput" type="text" label="Verification code" disabled="[[!canVerify]]" value="{{verifyCode}}" auto-validate="" pattern="[0-9]+" error-message="Check verify code number!" required="required"></paper-input><paper-button id="phoneSignIn" type="submit" on-tap="_signInPhone" disabled="[[!readyVerify]]">Sign In</paper-button><paper-button id="phoneVerify" type="submit" on-tap="_verifyPhone" hidden$="[[!computeStyle(readyVerify,canVerify)]]">Verify</paper-button></form></template><script>class PhoneLoginFire extends Polymer.Element{static get is(){return'phone-login-fire'}static get properties(){return{appName:{type:String},user:{type:Object,notify:!0,reflectToAttribute:!0},phoneNumber:{type:String},verifyCode:{type:String},signedIn:{type:Boolean,notify:!0,reflectToAttribute:!0},debug:{type:Boolean,value:!1},canVerify:{type:Boolean,value:!1},readyVerify:{type:Boolean,value:!1},autoSignUp:{type:Boolean,value:!1},statusKnown:{type:Boolean,notify:!0},appVerifier:{type:Object,notify:!0,observer:'_appVerifierChanged'}}}connectedCallback(){super.connectedCallback();var a=document.getElementById('recaptcha-container');if('undefined'!=typeof a&&null!=a)console.log('recaptcha-container-exit');else{console.log('create-recaptcha-container');var b=document.createElement('div');b.setAttribute('id','recaptcha-container'),document.body.appendChild(b)}var c=document.querySelector('#recaptcha-container'),d=firebase.app(this.appName);console.log(c),window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier(c,{size:'invisible',callback:function(){}},d),recaptchaVerifier.render().then(function(a){window.recaptchaWidgetId=a,this.appVerifier=window.recaptchaVerifier,this.readyVerify=!0}.bind(this))}disconnectedCallback(){var a=document.getElementById('recaptcha-container');'undefined'!=typeof a&&null!=a&&(console.log('remove recaptcha-container-exit'),document.body.removeChild(a))}computeStyle(a,b){return a&&b}_appVerifierChanged(a){'undefined'!==typeof a&&null!=a&&console.log('_appVerifierChanged')}_userChanged(a){'undefined'===typeof a||null==a||0===Object.keys(a).length&&a.constructor===Object||this.dispatchEvent(new CustomEvent('phone-signedin',{detail:a,bubbles:!0,composed:!0}))}_cleanMessages(){this.shadowRoot.querySelector('.emailPWError').textContent='',this.shadowRoot.querySelector('.emailPWMessage').textContent=''}isPhoneNumberValid(){var a=/^\+[0-9\s\-\(\)]+$/;return!!this.phoneNumber&&-1!==this.phoneNumber.search(a)}_signInPhone(){console.log('confirm phone:'+this.phoneNumber),this._cleanMessages();var a=firebase.app(this.appName);this.isPhoneNumberValid()?a.auth().signInWithPhoneNumber(this.phoneNumber,this.appVerifier).then(function(a){console.log('confirmationResult'),console.log(a),window.confirmationResult=a,this.canVerify=!0;var b=this.shadowRoot.querySelector('#codeInput').$.input.focus();console.log(b)}.bind(this)).catch(function(a){console.error('Error during signIn with phone number:'+a),this.shadowRoot.querySelector('.emailPWError').textContent=a.code,this.shadowRoot.querySelector('.emailPWMessage').textContent=a.message,this.phoneNumber=null}.bind(this)):this.shadowRoot.querySelector('.emailPWError').textContent='Invalid phone number'}_verifyPhone(){console.log('confirm code:'+this.verifyCode),window.confirmationResult.confirm(this.verifyCode)}signOut(){this.signedIn&&this.$.phone.signOut()}}customElements.define(PhoneLoginFire.is,PhoneLoginFire);</script></dom-module></body></html>